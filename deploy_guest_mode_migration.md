# ЁЯЪА Deploy Guest Mode Migration

## ЁЯУЛ **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕г Deploy:**

### **1. р╕гр╕▒р╕Щ Database Migration:**

#### **р╣Гр╕Щ Supabase Dashboard:**
1. р╣Др╕Ыр╕Чр╕╡р╣И **SQL Editor**
2. р╕зр╕▓р╕З **Complete Migration SQL** р╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
3. р╕Др╕ер╕┤р╕Б **Run** р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Щ migration
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕бр╣Ир╕бр╕╡ error

#### **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:**
```sql
-- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Хр╕▓р╕гр╕▓р╕З
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;

-- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ RLS Policies
SELECT schemaname, tablename, policyname 
FROM pg_policies 
WHERE schemaname = 'public'
ORDER BY tablename, policyname;
```

### **2. р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х Frontend Code:**

#### **тЬЕ TripService (р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з):**
- тЬЕ р╕гр╕нр╕Зр╕гр╕▒р╕Ъ guest_id
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ authentication status
- тЬЕ р╣Гр╕Кр╣Й user_id р╕лр╕гр╕╖р╕н guest_id р╕Хр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░

#### **тЬЕ AuthService (р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з):**
- тЬЕ Guest тЖТ Owner migration
- тЬЕ р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х trips, destinations, chat_messages
- тЬЕ р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х chat_sessions

### **3. р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ:**

#### **Guest Mode Test:**
1. **р╣Ар╕Ыр╕┤р╕Ф Browser** р╣Гр╕Щр╣Вр╕лр╕бр╕Ф Incognito
2. **р╣Др╕Ыр╕Чр╕╡р╣И** `http://localhost:8082`
3. **р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╣Ар╕Фр╕┤р╕Щр╕Чр╕▓р╕З** (Guest Mode)
4. **р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕Цр╕▓р╕Щр╕Чр╕╡р╣И** р╕Ьр╣Ир╕▓р╕Щ AI Chat
5. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Database** р╕зр╣Ир╕▓р╕бр╕╡ guest_id

#### **Auth Mode Test:**
1. **р╕Др╕ер╕┤р╕Б "р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б"**
2. **р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕лр╕гр╕╖р╕нр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ**
3. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Migration** р╕зр╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕╣р╕Бр╕вр╣Йр╕▓р╕в
4. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Database** р╕зр╣Ир╕▓р╕бр╕╡ user_id

### **4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ RLS Policies:**

#### **Guest Access Test:**
```sql
-- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Guest р╕кр╕▓р╕бр╕▓р╕гр╕Ц INSERT р╣Др╕Фр╣Й
-- (р╕Хр╣Йр╕нр╕Зр╣Др╕бр╣Ир╕бр╕╡ error)
```

#### **Auth Access Test:**
```sql
-- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ User р╕кр╕▓р╕бр╕▓р╕гр╕Ц SELECT р╣Др╕Фр╣Й
-- (р╕Хр╣Йр╕нр╕Зр╣Др╕бр╣Ир╕бр╕╡ error)
```

## ЁЯОп **р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З:**

### **тЬЕ Guest Mode:**
- тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕Ьр╕Щр╣Др╕Фр╣Йр╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕кр╕бр╕▒р╕Др╕г
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Фр╣Йр╕зр╕в guest_id
- тЬЕ AI Chat р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Й
- тЬЕ Drag & Drop р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Й

### **тЬЕ Auth Mode:**
- тЬЕ р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Й
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕╣р╕Б migrate р╕Ир╕▓р╕Б guest_id тЖТ user_id
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Ыр╣Зр╕Щр╕Вр╕нр╕З User р╕Ир╕гр╕┤р╕З
- тЬЕ р╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Йр╕Ир╕▓р╕Бр╕Чр╕╕р╕Бр╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣М

### **тЬЕ Migration:**
- тЬЕ Guest тЖТ Owner seamless
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕лр╕▓р╕в
- тЬЕ р╕Ыр╕гр╕░р╕кр╕Ър╕Бр╕▓р╕гр╕Ур╣Мр╕кр╕бр╕╣р╕Ч

## ЁЯЪи **р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕░р╕зр╕▒р╕З:**

### **1. RLS Policies:**
- р╕Хр╣Йр╕нр╕Зр╕гр╕▒р╕Щ migration р╣Гр╕лр╣Йр╕Др╕гр╕Ъ
- р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ policies р╕зр╣Ир╕▓р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Й

### **2. Data Migration:**
- р╕Хр╣Йр╕нр╕Зр╕Чр╕Фр╕кр╕нр╕Ъ Guest тЖТ Owner flow
- р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕╣р╕Бр╕вр╣Йр╕▓р╕вр╕Др╕гр╕Ъ

### **3. Error Handling:**
- р╕Хр╣Йр╕нр╕Зр╕бр╕╡ fallback р╕кр╕│р╕лр╕гр╕▒р╕Ъ migration errors
- р╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕З error messages р╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Др╕Фр╣Й

## ЁЯУЛ **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы:**

1. **р╕гр╕▒р╕Щ Migration** - Deploy database schema
2. **р╕Чр╕Фр╕кр╕нр╕Ъ Guest Mode** - р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕Ьр╕Щр╣Вр╕Фр╕вр╣Др╕бр╣Ир╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ
3. **р╕Чр╕Фр╕кр╕нр╕Ъ Auth Mode** - р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Бр╕ер╣Йр╕зр╕Фр╕╣р╣Бр╕Ьр╕Щ
4. **р╕Чр╕Фр╕кр╕нр╕Ъ Migration** - Guest тЖТ Owner flow
5. **Production Ready** - р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

## ЁЯОЙ **р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:**

- тЬЕ **Guest Mode** - р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡
- тЬЕ **Auth Mode** - р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Й
- тЬЕ **Migration** - р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕лр╕▓р╕в
- тЬЕ **Complete System** - р╕гр╕░р╕Ър╕Ър╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
